System.register(["./@vue-legacy.js"],(function(e,t){"use strict";var a,o,n,i,l,r,s,d,u,c,p,m;return{setters:[e=>{a=e.U,o=e.k,n=e.x,i=e.az,l=e.a9,r=e.M,s=e.o,d=e.c,u=e.a,c=e.t,p=e.f,m=e.Y}],execute:function(){const t=e=>e+"_"+(Date.now()+Math.floor(1e6*Math.random())),_=()=>{const e="undefined"!=typeof window?window:global;return e&&"tinymce"in e?e.tinymce:null};function g(e){return e?e.getContent():""}function b(e,t){t&&t.setContent(e)}function f(e,t=!0){e&&e.mode.set(t?"readonly":"design")}function y(e,t,a){return new Promise(((o,n)=>{let i,l,{images_upload_url:r,images_upload_credentials:s,custom_images_upload_header:d,custom_images_upload_param:u,custom_images_upload_callback:c,custom_images_limit_size:p}=e||{};p&&t.blob().size>p?n(`图片大小不能超过 ${p/1024}KB`):(i=new XMLHttpRequest,i.withCredentials=!!s,i.open("POST",r||""),d&&Object.keys(d).forEach((e=>{i.setRequestHeader(e,d[e])})),i.upload.onprogress=function(e){a(e.loaded/e.total*100)},i.onload=function(){if(403===i.status)return void n({message:"HTTP Error: "+i.status,remove:!0});if(i.status<200||i.status>=300)return void n("HTTP Error: "+i.status);let e=JSON.parse(i.responseText);if(!e)return void n("Invalid JSON: "+i.responseText);let t="function"==typeof c?c(e):e.location;t?o(t):n("Failed Path: location image path is error/empty")},i.onerror=function(){n("Image upload failed due to a XHR Transport error. Code: "+i.status)},l=new FormData,l.append("file",t.blob(),t.filename()),u&&Object.keys(u).forEach((e=>{l.append(e,u[e])})),i.send(l))}))}const h=(()=>{let e={status:{},loadedCallbacks:{}};const a=t=>{e.loadedCallbacks[t]&&(e.loadedCallbacks[t].forEach((e=>{"function"==typeof e.handler&&e.handler.call(e.scope)})),e.loadedCallbacks[t]=void 0)};return{load:(o,n,i)=>{n&&(e.loadedCallbacks[o]||(e.loadedCallbacks[o]=[]),e.loadedCallbacks[o].push({handler:n,scope:i||globalThis})),"LOADED"!==e.status[o]?"LOADING"!==e.status[o]&&(e.status[o]="LOADING",((e,a)=>{const o=document.createElement("script");o.id=t("tiny-script"),o.type="application/javascript",o.src=e,o.referrerPolicy="origin";const n=()=>{o.removeEventListener("load",n),a()};o.addEventListener("load",n),(document.head||document.body).appendChild(o)})(o,(()=>{e.status[o]="LOADED",a(o)}))):a(o)}}})(),v=["id"],x={key:0},k={name:"Vue3Tinymce"};e("_",Object.assign(k,{props:{modelValue:String,setting:{type:Object,default:()=>({})},setup:Function,disabled:Boolean,scriptSrc:String,debug:Boolean},emits:["update:modelValue","init","change"],setup(e,{expose:k,emit:C}){const w=e,j=C;let z=!0;const S=a({editor:null,id:t("tinymce"),err:""}),T=()=>String(w.modelValue??""),O=(e,t,a)=>{w.debug&&console.log(`来自：${e.type} | \n ${t} \n ${a||"--"}`)},E=(e,t)=>{t||(t=S.editor);const a=g(t);O(e,a),j("update:modelValue",a),j("change",a)},D=()=>{if(null===_())return void(S.err="tinymce is null");w.debug&&console.warn("vue3-tinymce 进入debug模式");let e={...w.setting,selector:`#${S.id}`,content_style:(t=w.setting?.content_style,"body{font-size: 14px;} img{padding: 0 2px;} "+(t||"")),setup:e=>{S.editor=e,w.setup&&w.setup(e),e.on("init",(()=>(e=>{b(T(),e),w.disabled&&"readonly"!==e.mode.get()&&f(e),e.on("change input undo redo",(t=>{E(t,e)})),j("init",e)})(e)))}};var t;w.setting.custom_images_upload&&(e.images_upload_handler=(...e)=>y.apply(null,[w.setting,...e])),_().init(e),z=!1};return o((()=>w.modelValue),((e,t)=>{if(S.editor&&S.editor.initialized&&t!==e&&e!==g(S.editor)){if(O({type:"propsChanged to setContent"},e,t),null===e)return function(e,t){if(t){if(t.resetContent)return t.resetContent(e);t.setContent(e),t.setDirty(!1),t.undoManager.clear()}}("",S.editor);b(T(),S.editor)}})),o((()=>w.disabled),(e=>{S.editor&&S.editor.initialized&&f(S.editor,e)})),k({id:S.id,editor:S.editor}),n((()=>{if(null!==_())return void D();const e=w.scriptSrc??"https://cdn.bootcdn.net/ajax/libs/tinymce/6.1.2/tinymce.min.js";h.load(e,D)})),i((()=>{z||D()})),l((()=>{S.editor&&_()?.remove(`#${S.id}`)})),r((()=>{S.editor&&_()?.remove(`#${S.id}`)})),(e,t)=>(s(),d(m,null,[u("div",{id:S.id,class:"tiny-textarea"},null,8,v),S.err?(s(),d("p",x,c(S.err),1)):p("",!0)],64))}})),e("t",{convert_urls:!1,custom_images_upload:!0,images_upload_url:"/api/upload",custom_images_limit_size:204800,branding:!1,menubar:!0,body_class:"article-content ",object_resizing:!0,paste_data_images:!0,paste_merge_formats:!0,end_container_on_empty_block:!0,powerpaste_word_import:"clean",advlist_bullet_styles:"default,circle,disc,square",advlist_number_styles:"default,lower-alpha,lower-greek,lower-roman,upper-alpha,upper-roman",default_link_target:"_blank",link_title:!1,nonbreaking_force_tab:!0,custom_images_upload_callback:e=>{if(200===e.code)return e.data.path},images_upload_credentials:!0,custom_images_upload_header:{"X-Token":"xxxx"},custom_images_upload_param:{},height:550,toolbar:"undo redo| code codesample | fullscreen | blocks alignleft aligncenter alignright alignjustify | link unlink | numlist bullist | image media table | fontsize forecolor backcolor | bold italic underline strikethrough | indent outdent | superscript subscript | removeformat |",toolbar_mode:"sliding",quickbars_selection_toolbar:"removeformat | bold italic underline strikethrough | fontsize forecolor backcolor",plugins:"link code image media table lists fullscreen quickbars codesample",font_size_formats:"12px 14px 16px 18px 20px 22px 24px 26px 28px 30px 32px 34px 36px 38px 40px",link_default_target:"_blank",valid_elements:"*[*]",allow_html_in_named_anchor:!0,language:"zh-Hans",language_url:"/public/admin/tinymce/zh-Hans.js",codesample_languages:[{text:"HTML/XML",value:"markup"},{text:"JavaScript",value:"javascript"},{text:"CSS",value:"css"},{text:"PHP",value:"php"},{text:"Ruby",value:"ruby"},{text:"Python",value:"python"},{text:"Java",value:"java"},{text:"C",value:"c"},{text:"C#",value:"csharp"},{text:"C++",value:"cpp"}]})}}}));
