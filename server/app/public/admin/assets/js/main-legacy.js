System.register(["./@vue-legacy.js"],(function(e,t){"use strict";var n,o,i,a,s,r,d,l,u,c,p,m;return{setters:[e=>{n=e.U,o=e.k,i=e.x,a=e.az,s=e.a9,r=e.M,d=e.o,l=e.c,u=e.a,c=e.t,p=e.f,m=e.Y}],execute:function(){const t=e=>e+"_"+(Date.now()+Math.floor(1e6*Math.random())),g=()=>{const e="undefined"!=typeof window?window:global;return e&&"tinymce"in e?e.tinymce:null};function f(e){return e?e.getContent():""}function y(e,t){t&&t.setContent(e)}function b(e,t=!0){e&&e.mode.set(t?"readonly":"design")}function _(e,t,n){return new Promise(((o,i)=>{let a,s,{images_upload_url:r,images_upload_credentials:d,custom_images_upload_header:l,custom_images_upload_param:u,custom_images_upload_callback:c,custom_images_limit_size:p}=e||{};p&&t.blob().size>p?i(`图片大小不能超过 ${p/1024}KB`):(a=new XMLHttpRequest,a.withCredentials=!!d,a.open("POST",r||""),l&&Object.keys(l).forEach((e=>{a.setRequestHeader(e,l[e])})),a.upload.onprogress=function(e){n(e.loaded/e.total*100)},a.onload=function(){if(403===a.status)return void i({message:"HTTP Error: "+a.status,remove:!0});if(a.status<200||a.status>=300)return void i("HTTP Error: "+a.status);let e=JSON.parse(a.responseText);if(!e)return void i("Invalid JSON: "+a.responseText);let t="function"==typeof c?c(e):e.location;t?o(t):i("Failed Path: location image path is error/empty")},a.onerror=function(){i("Image upload failed due to a XHR Transport error. Code: "+a.status)},s=new FormData,s.append("file",t.blob(),t.filename()),u&&Object.keys(u).forEach((e=>{s.append(e,u[e])})),a.send(s))}))}const h=(()=>{let e={status:{},loadedCallbacks:{}};const n=t=>{e.loadedCallbacks[t]&&(e.loadedCallbacks[t].forEach((e=>{"function"==typeof e.handler&&e.handler.call(e.scope)})),e.loadedCallbacks[t]=void 0)};return{load:(o,i,a)=>{i&&(e.loadedCallbacks[o]||(e.loadedCallbacks[o]=[]),e.loadedCallbacks[o].push({handler:i,scope:a||globalThis})),"LOADED"!==e.status[o]?"LOADING"!==e.status[o]&&(e.status[o]="LOADING",((e,n)=>{const o=document.createElement("script");o.id=t("tiny-script"),o.type="application/javascript",o.src=e,o.referrerPolicy="origin";const i=()=>{o.removeEventListener("load",i),n()};o.addEventListener("load",i),(document.head||document.body).appendChild(o)})(o,(()=>{e.status[o]="LOADED",n(o)}))):n(o)}}})(),v=["id"],C={key:0},k={name:"Vue3Tinymce"};e("_",Object.assign(k,{props:{modelValue:String,setting:{type:Object,default:()=>({})},setup:Function,disabled:Boolean,scriptSrc:String,debug:Boolean},emits:["update:modelValue","init","change"],setup(e,{expose:k,emit:O}){const w=e,E=O;let T=!0;const x=n({editor:null,id:t("tinymce"),err:""}),D=()=>String(w.modelValue??""),S=(e,t,n)=>{w.debug&&console.log(`来自：${e.type} | \n ${t} \n ${n||"--"}`)},j=(e,t)=>{t||(t=x.editor);const n=f(t);S(e,n),E("update:modelValue",n),E("change",n)},L=()=>{if(null===g())return void(x.err="tinymce is null");w.debug&&console.warn("vue3-tinymce 进入debug模式");let e={...w.setting,selector:`#${x.id}`,content_style:(t=w.setting?.content_style,"body{font-size: 14px;} img{padding: 0 2px;} "+(t||"")),setup:e=>{x.editor=e,w.setup&&w.setup(e),e.on("init",(()=>(e=>{y(D(),e),w.disabled&&"readonly"!==e.mode.get()&&b(e),e.on("change input undo redo",(t=>{j(t,e)})),E("init",e)})(e)))}};var t;w.setting.custom_images_upload&&(e.images_upload_handler=(...e)=>_.apply(null,[w.setting,...e])),g().init(e),T=!1};return o((()=>w.modelValue),((e,t)=>{if(x.editor&&x.editor.initialized&&t!==e&&e!==f(x.editor)){if(S({type:"propsChanged to setContent"},e,t),null===e)return function(e,t){if(t){if(t.resetContent)return t.resetContent(e);t.setContent(e),t.setDirty(!1),t.undoManager.clear()}}("",x.editor);y(D(),x.editor)}})),o((()=>w.disabled),(e=>{x.editor&&x.editor.initialized&&b(x.editor,e)})),k({id:x.id,editor:x.editor}),i((()=>{if(null!==g())return void L();const e=w.scriptSrc??"https://cdn.bootcdn.net/ajax/libs/tinymce/6.1.2/tinymce.min.js";h.load(e,L)})),a((()=>{T||L()})),s((()=>{x.editor&&g()?.remove(`#${x.id}`)})),r((()=>{x.editor&&g()?.remove(`#${x.id}`)})),(e,t)=>(d(),l(m,null,[u("div",{id:x.id,class:"tiny-textarea"},null,8,v),x.err?(d(),l("p",C,c(x.err),1)):p("",!0)],64))}}))}}}));
