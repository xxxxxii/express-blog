System.register(["./@vue-legacy.js"],(function(e,t){"use strict";var n,o,a,i,r,l,s,d,u,c,p,m;return{setters:[e=>{n=e.r,o=e.w,a=e.d,i=e.e,r=e.f,l=e.g,s=e.o,d=e.c,u=e.a,c=e.t,p=e.h,m=e.F}],execute:function(){const t=e=>e+"_"+(Date.now()+Math.floor(1e6*Math.random())),g=()=>{const e="undefined"!=typeof window?window:global;return e&&"tinymce"in e?e.tinymce:null};function f(e){return e?e.getContent():""}function y(e,t){t&&t.setContent(e)}function b(e,t=!0){e&&e.mode.set(t?"readonly":"design")}function v(e,t,n){return new Promise(((o,a)=>{let i,r,{images_upload_url:l,images_upload_credentials:s,custom_images_upload_header:d,custom_images_upload_param:u,custom_images_upload_callback:c}=e||{};i=new XMLHttpRequest,i.withCredentials=!!s,i.open("POST",l||""),d&&Object.keys(d).forEach((e=>{i.setRequestHeader(e,d[e])})),i.upload.onprogress=function(e){n(e.loaded/e.total*100)},i.onload=function(){if(403===i.status)return void a({message:"HTTP Error: "+i.status,remove:!0});if(i.status<200||i.status>=300)return void a("HTTP Error: "+i.status);let e=JSON.parse(i.responseText);if(!e)return void a("Invalid JSON: "+i.responseText);let t="function"==typeof c?c(e):e.location;t?o(t):a("Failed Path: location image path is error/empty")},i.onerror=function(){a("Image upload failed due to a XHR Transport error. Code: "+i.status)},r=new FormData,r.append("file",t.blob(),t.filename()),u&&Object.keys(u).forEach((e=>{r.append(e,u[e])})),i.send(r)}))}const h=(()=>{let e={status:{},loadedCallbacks:{}};const n=t=>{e.loadedCallbacks[t]&&(e.loadedCallbacks[t].forEach((e=>{"function"==typeof e.handler&&e.handler.call(e.scope)})),e.loadedCallbacks[t]=void 0)};return{load:(o,a,i)=>{a&&(e.loadedCallbacks[o]||(e.loadedCallbacks[o]=[]),e.loadedCallbacks[o].push({handler:a,scope:i||globalThis})),"LOADED"!==e.status[o]?"LOADING"!==e.status[o]&&(e.status[o]="LOADING",((e,n)=>{const o=document.createElement("script");o.id=t("tiny-script"),o.type="application/javascript",o.src=e,o.referrerPolicy="origin";const a=()=>{o.removeEventListener("load",a),n()};o.addEventListener("load",a),(document.head||document.body).appendChild(o)})(o,(()=>{e.status[o]="LOADED",n(o)}))):n(o)}}})(),_=["id"],C={key:0},k={name:"Vue3Tinymce"},w=e("_",Object.assign(k,{props:{modelValue:String,setting:{type:Object,default:()=>({})},setup:Function,disabled:Boolean,scriptSrc:String,debug:Boolean},emits:["update:modelValue","init","change"],setup(e,{expose:k,emit:w}){const O=e;let T=!0;const E=n({editor:null,id:t("tinymce"),err:""}),D=()=>{var e;return String(null!=(e=O.modelValue)?e:"")},S=(e,t,n)=>{O.debug&&console.log(`来自：${e.type} | \n ${t} \n ${n||"--"}`)},j=(e,t)=>{t||(t=E.editor);const n=f(t);S(e,n),w("update:modelValue",n),w("change",n)},x=()=>{var e;if(null===g())return void(E.err="tinymce is null");O.debug&&console.warn("vue3-tinymce 进入debug模式");let t={...O.setting,selector:`#${E.id}`,content_style:(n=null==(e=O.setting)?void 0:e.content_style,"body{font-size: 14px;} img{padding: 0 2px;} "+(n||"")),setup:e=>{E.editor=e,O.setup&&O.setup(e),e.on("init",(()=>(e=>{y(D(),e),O.disabled&&"readonly"!==e.mode.get()&&b(e),e.on("change input undo redo",(t=>{j(t,e)})),w("init",e)})(e)))}};var n;O.setting.custom_images_upload&&(t.images_upload_handler=(...e)=>v.apply(null,[O.setting,...e])),g().init(t),T=!1};return o((()=>O.modelValue),((e,t)=>{if(E.editor&&E.editor.initialized&&t!==e&&e!==f(E.editor)){if(S({type:"propsChanged to setContent"},e,t),null===e)return function(e,t){if(t){if(t.resetContent)return t.resetContent(e);t.setContent(e),t.setDirty(!1),t.undoManager.clear()}}("",E.editor);y(D(),E.editor)}})),o((()=>O.disabled),(e=>{E.editor&&E.editor.initialized&&b(E.editor,e)})),k({id:E.id,editor:E.editor}),a((()=>{var e;if(null!==g())return void x();const t=null!=(e=O.scriptSrc)?e:"https://cdn.bootcdn.net/ajax/libs/tinymce/6.1.2/tinymce.min.js";h.load(t,x)})),i((()=>{T||x()})),r((()=>{var e;E.editor&&(null==(e=g())||e.remove(`#${E.id}`))})),l((()=>{var e;E.editor&&(null==(e=g())||e.remove(`#${E.id}`))})),(e,t)=>(s(),d(m,null,[u("div",{id:E.id,class:"tiny-textarea"},null,8,_),E.err?(s(),d("p",C,c(E.err),1)):p("",!0)],64))}}));w.install=function(e){e.component("Vue3Tinymce",w)}}}}));
